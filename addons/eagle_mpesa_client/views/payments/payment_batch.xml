<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="payment_batch_search" model="ir.ui.view">
        <field name="name">payment.batch.search</field>
        <field name="model">payment.batch</field>
        <field name="arch" type="xml">
            <search string="Payment Batch">
                <field name="name" />
                <field name="create_uid" />
                <field name="state" />
                <filter string="State" name="txn_state"
                    context="{'group_by':'state'}"></filter>

                <filter string="Created by" name="creator"
                    context="{'group_by':'create_uid'}"></filter>

                <filter string="Pending" name="pending" domain="[('state', '=', 'pending')]" />

                <filter string="Pre-Approved" name="pre_approved"
                    domain="[('state', '=', 'pre_approved')]" />
                <filter string="Approved" name="been_approved" domain="[('state', '=', 'approved')]" />

                <filter string="Cancelled" name="cancelled" domain="[('state', '=', 'cancel')]" />

            </search>
        </field>
    </record>

    <record id="payment_batch_form" model="ir.ui.view">
        <field name="name">payment.batch.form</field>
        <field name="model">payment.batch</field>
        <field name="arch" type="xml">
            <form string="Payment Batch">
                <header>
                    <!-- <button name="action_submit" type="object" string="Submit" class="btn-primary"
                        invisible="state != 'draft' or not names_validated_boolean" />
                  
                    <button name="validate_phone_numbers" type="object"
                        string="Validate Phone Account Holders" class="btn-warning"
                        invisible="state != 'draft' or names_validated_boolean" />
                   
                    <button name="action_send_code" type="object" string="Re-send Email"
                        class="btn-primary"
                        invisible="state != 'submitted'" />
                    <button name="cancel" type="object" string="Cancel"
                        class="btn-danger"
                        invisible="state in ['cancel'] or level_progress != 0" /> -->

                    <button name="confirm_payment_batch" type="object" groups="eagle_mpesa_client.group_kpayment_approver_batch_confirm" string="Confirm Payment Batch" class="btn-warning" invisible="state != 'draft'"/>
                    <button name="preapprove_payment_batch" type="object" groups="eagle_mpesa_client.group_kpayment_approver_batch_pre_approve" string="Pre-Approve Payment Batch" class="btn-primary" invisible="state != 'pending'"/>
                    <button name="approve_payment_batch" type="object" groups="eagle_mpesa_client.group_kpayment_approver_batch_approve" string="Approve Payment Batch" class="btn-success" invisible="state != 'pre_approved'"/>
                    <button name="reject_payment_batch" type="object" string="Reject/Cancel Payment Batch" class="btn-danger" invisible="state in ['approved','cancelled']" 
                        groups="eagle_mpesa_client.group_kpayment_approver_batch_confirm,eagle_mpesa_client.group_kpayment_approver_batch_pre_approve,eagle_mpesa_client.group_kpayment_approver_batch_approve"/>

                    <field name="state" statusbar_visible="draft,pending,pre_approved,approved,cancelled"
                        widget="statusbar" />
                </header>
                <sheet>

                    <div name="button_box" class="oe_button_box" position="inside">
                        <button type="object" name="view_successful" icon="fa-check"
                            invisible="done_txns==0">
                            <field name="done_txns" /> Completed </button>
                        <button type="object" name="view_failed" icon="fa-times"
                            invisible="failed_txns==0">
                            <field name="failed_txns" /> Failed </button>

                    </div>
                    <div class="oe_title">

                        <span class="o_form_label">Payment Batch</span>
                        <h1>
                            <field name="name" readonly="1" force_save="1" />
                        </h1>

                    </div>
                    <br />
                    <group>
                        <group>
                            <field name="state" invisible="1" />
                            <field name="level_progress" invisible="1"/>
                            <field name="create_uid" string="Intiated by"
                                options="{'no_open': True, 'no_create': True}" />
                            <field name="create_date" string="Date" />
                            <field name="cancel_reason_id" 
                                invisible="state != 'cancel'" readonly="state != 'draft'" />
                            <field name="test_recipient_email" readonly="state == 'approved'" invisible="1"/>

                        </group>
                        <group>
                            <field name="amount"/>
                            <field name="charges"/>
                            <field name="total"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="payment_lines" string="Payments">
                            <field name="eagle_payment_ids" readonly="1">
                                <list editable="top">
                                    
                                    <field name="name" />
                                    <field name="employee_id" />
                                    <field name="work_phone" />
                                    <field name="phone_validity"
                                        widget="badge" readonly="1"
                                        decoration-success="phone_validity == 'valid'"
                                        decoration-danger="phone_validity == 'invalid'"
                                    />
                                    <field name="id_type" />
                                    <field name="identification_id" />


                                    <field name="currency_id" column_invisible="1" />

                                    <field name="amount" readonly="1" sum="Total"
                                        options="{'currency_field': 'currency_id'}"
                                        widget="monetary" />

                                    <field name="currency_id" optional="hide" readonly="1" />
                                    <field name="charges" sum="Total Charged" optional="hide"
                                        options="{'currency_field': 'currency_id'}"
                                        widget="monetary"  readonly="1" />
                                    <field name="total" sum="Total"
                                        options="{'currency_field': 'currency_id'}"
                                        widget="monetary"  readonly="1" />
                                    <field name="create_date" string="Date"  />
                                    <field name="create_uid" string="Created By" optional="hide"/>
                                    <field name="state"
                                        widget="badge" readonly="1"
                                        decoration-success="state == 'done'"
                                        decoration-danger="state in ['cancel','failed']"
                                        decoration-warning="state == 'pending'"
                                        decoration-primary="state == 'draft'"
                                    />
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>

                <!--Chatter-->
                 <chatter />
            </form>
        </field>
    </record>

    <!--===============
    Request Disbursements TREE VIEW===================-->
    <record id="payment_batch_list" model="ir.ui.view">
        <field name="name">payment.batch.list</field>
        <field name="model">payment.batch</field>
        <field name="arch" type="xml">
            <list string="Payment Batch">

                <field name="name" />
                <field name="create_uid" string="Initiated by"
                />
                <field name="create_date" string="Date" optional="show" />
                <field name="amount" sum="Total"
                options="{'currency_field': 'currency_id'}"
                widget="monetary"/>
                <field name="charges" sum="Total" optional="hide"
                options="{'currency_field': 'currency_id'}"
                widget="monetary"/>
                <field name="total"  sum="Total"
                options="{'currency_field': 'currency_id'}"
                widget="monetary"/>

                <field name="state"
                    widget="badge"
                    decoration-success="state == 'approved'"
                    decoration-primary="state == 'pre_approved'"
                    decoration-info="state == 'draft'"
                    decoration-danger="state == 'cancel'"
                    decoration-warning="state == 'pending'"
                />
                <field name="currency_id" column_invisible="1"/>
                <field name="level_progress" widget="progressbar" optional="hide"/>
            </list>
        </field>
    </record>

    <record id="payment_batch_action" model="ir.actions.act_window">
        <field name="name">Payment Batch</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">payment.batch</field>
        <field name="view_mode">list,form,search</field>
        <field name="view_id" ref="eagle_mpesa_client.payment_batch_list" />
        <field name="search_view_id" ref="payment_batch_search" />
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a Payment Batch
            </p>
        </field>
    </record>


</odoo>