<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Professional Appointment Booking Page -->
    <template id="appointment_booking_page" name="Book Appointment">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <!-- Hero Section with Background Image and Fade -->
                <div class="hero-section position-relative" style="padding: 40px 0; margin-bottom: 30px; overflow: hidden;">
                    <!-- Background image with fade effect -->
                    <div class="hero-bg-image"></div>
                    <div class="hero-bg-overlay"></div>

                    <div class="container position-relative" style="z-index: 2;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="display-5 font-weight-bold text-dark mb-2">
                                    <t t-esc="request.env.company.name or 'Professional Services'"/>
                                </h1>
                                <p class="text-muted mb-0">Book your appointment with our professional team</p>
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    .hero-section {
                        min-height: 200px;
                        display: flex;
                        align-items: center;
                    }
                    .hero-bg-image {
                        position: absolute;
                        top: 0;
                        right: 0;
                        width: 100%;
                        height: 100%;
                        background-image: url('/custom_appointments/static/src/img/lashes.JPG');
                        background-size: cover;
                        background-position: right center;
                        z-index: 1;
                    }
                    .hero-bg-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg,
                            rgba(255,255,255,1) 0%,
                            rgba(255,255,255,0.9) 30%,
                            rgba(255,255,255,0.6) 60%,
                            rgba(255,255,255,0) 100%);
                        z-index: 1;
                    }
                </style>

                <div class="container">
                    <!-- Branch Selection (Top) -->
                    <div class="branch-selection mb-5">
                        <div class="card shadow border-0" style="border-radius: 18px; overflow: hidden;">
                            <div class="card-header bg-gradient-primary text-white p-4" style="background: linear-gradient(135deg, #ff69b4, #ff8da1); border: none;">
                                <h4 class="font-weight-bold mb-0">Select a Branch</h4>
                                <p class="mb-0 opacity-75">Choose where you'd like to book your appointment</p>
                            </div>

                            <div class="card-body p-4">
                                <div class="branch-selection-container">
                                    <div class="row">
                                        <t t-if="branches">
                                            <t t-foreach="branches" t-as="branch">
                                                <div class="col-md-6 mb-3">
                                                    <div class="branch-card" style="cursor: pointer; height: 100%;" t-att-onclick="'selectBranch(this, \'' + str(branch.id) + '\')'">
                                                        <div class="card h-100" t-att-style="'border-radius: 12px; border: 2px solid ' + ('#ff69b4' if selected_branch and branch.id == selected_branch.id else 'transparent') + '; box-shadow: 0 3px 15px rgba(0,0,0,0.05); transition: all 0.3s ease; background: ' + ('#fff5f8' if selected_branch and branch.id == selected_branch.id else '') + ';'">
                                                            <div class="card-body p-4">
                                                                <div class="d-flex flex-column h-100">
                                                                    <div>
                                                                        <div class="d-flex align-items-center mb-4">

                                                                            <h5 class="font-weight-bold mb-0 ml-2"><t t-esc="branch.name"/></h5>
                                                                        </div>

                                                                        <div class="branch-details mt-3 ml-2">
                                                                            <t t-if="branch.street">
                                                                                <p class="text-muted mb-2">
                                                                                    <i class="fa fa-map-marker mr-2"></i>
                                                                                    <t t-esc="branch.street"/>
                                                                                </p>
                                                                            </t>
                                                                            <t t-if="branch.phone">
                                                                                <p class="text-muted mb-2">
                                                                                    <i class="fa fa-phone mr-2"></i>
                                                                                    <t t-esc="branch.phone"/>
                                                                                </p>
                                                                            </t>
                                                                            <p class="text-muted mb-0">
                                                                                <i class="fa fa-clock-o mr-2"></i>
                                                                                Open today: 9:00 AM - 6:00 PM
                                                                            </p>
                                                                        </div>
                                                                    </div>
                                                                    <div class="mt-auto text-right">
                                                                        <span class="badge px-3 py-2 selection-indicator" t-att-class="'badge-success' if selected_branch and branch.id == selected_branch.id else 'badge-light'" t-att-style="'border-radius: 50px; ' + ('visibility: visible;' if selected_branch and branch.id == selected_branch.id else 'visibility: hidden;')">
                                                                            <i class="fa fa-check-circle mr-1"></i><t t-if="selected_branch and branch.id == selected_branch.id">Selected</t>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <div class="col-12 text-center py-4">
                                                <i class="fa fa-building fa-2x text-muted mb-2"></i>
                                                <p class="text-muted small">No branches available</p>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Staff Selection Grid in a Separate Card (Full Width) -->
                        <div class="col-lg-12 mb-4">
                            <div class="card shadow-sm border-0" style="border-radius: 15px; overflow: hidden;">
                                <div class="card-header bg-gradient-primary text-white p-4" style="background: linear-gradient(135deg, #ff69b4, #ff8da1); border: none;">
                                    <h4 class="font-weight-bold mb-0">Select Your Specialist</h4>
                                    <p class="mb-0 opacity-75">Choose the professional you'd like to work with</p>
                                </div>
                                <div class="card-body p-4">
                                    <div class="staff-grid">
                                        <div class="row">
                                            <t t-if="staff_members">
                                                <t t-foreach="staff_members" t-as="staff">
                                                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                                                        <div class="staff-card" style="cursor: pointer; height: 100%;" t-att-onclick="'selectStaff(this, \'' + str(staff.id) + '\')'">
                                                            <div class="card h-100" style="border-radius: 15px; border: 2px solid transparent; box-shadow: 0 5px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; min-height: 350px;">
                                                                <div class="card-body p-3 d-flex flex-column">
                                                                    <div class="text-center mb-3">
                                                                        <t t-if="staff.image">
                                                                            <img t-att-src="'/web/image/custom.staff.member/%s/image/120x120' % staff.id"
                                                                                class="rounded-circle mx-auto staff-image"
                                                                                style="width: 100px; height: 100px; object-fit: cover; border: 4px solid #f0f0f0; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"
                                                                                alt="Staff Photo"/>
                                                                        </t>
                                                                        <t t-else="">
                                                                            <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center mx-auto staff-image"
                                                                                style="width: 100px; height: 100px; border: 4px solid #f0f0f0; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                                                                <i class="fa fa-user text-white fa-2x"></i>
                                                                            </div>
                                                                        </t>
                                                                    </div>
                                                                    <div class="text-center flex-grow-1 d-flex flex-column justify-content-between">
                                                                        <div>
                                                                            <h5 class="font-weight-bold mb-1"><t t-esc="staff.name"/></h5>
                                                                            <t t-if="staff.specialization">
                                                                                <p class="text-muted mb-2"><t t-esc="staff.specialization"/></p>
                                                                            </t>
                                                                            <t t-else="">
                                                                                <p class="text-muted mb-2">Specialist</p>
                                                                            </t>

                                                                            <div class="rating mb-2">
                                                                                <t t-foreach="range(5)" t-as="star">
                                                                                    <i class="fa fa-star text-warning"></i>
                                                                                </t>
                                                                                <span class="text-muted small ml-1">5.0</span>
                                                                            </div>
                                                                            <div class="expertise-badges mt-2">
                                                                                <span class="badge badge-light mr-1">Expert</span>
                                                                                <span class="badge badge-light">5+ Years</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="selection-indicator mt-3" style="display: none;">
                                                                            <span class="badge badge-success px-3 py-2" style="border-radius: 50px;">
                                                                                <i class="fa fa-check-circle mr-1"></i> Selected
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </t>
                                            <t t-else="">
                                                <div class="col-12 text-center py-4">
                                                    <i class="fa fa-users fa-3x text-muted mb-3"></i>
                                                    <h6 class="text-muted">No Staff Available</h6>
                                                    <p class="text-muted small">Please contact us directly for appointments.</p>
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Location Details with Unique Styling -->
                        <div class="col-lg-12 mb-4">
                            <div class="location-card shadow-sm border-0" style="border-radius: 20px; overflow: hidden; background-image: linear-gradient(to right, #fff, #fff5f8); position: relative;">
                                <!-- Decorative Elements -->
                                <div class="decorative-circle" style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; border-radius: 50%; background: rgba(255,105,180,0.1); z-index: 1;"></div>
                                <div class="decorative-circle" style="position: absolute; bottom: -20px; left: -40px; width: 100px; height: 100px; border-radius: 50%; background: rgba(255,105,180,0.08); z-index: 1;"></div>



                                <div class="card-body p-4" style="position: relative; z-index: 2;">
                                    <!-- Full-width Map Placeholder with Enhanced Styling -->
                                    <div class="map-container mb-4" style="position: relative; height: 280px; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                                        <!-- Map Background -->
                                        <div class="map-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #f8f9fa, #fff);">
                                            <!-- Decorative Map Elements -->
                                            <div style="position: absolute; top: 20%; left: 30%; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,105,180,0.1);"></div>
                                            <div style="position: absolute; top: 60%; left: 20%; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.05);"></div>
                                            <div style="position: absolute; top: 40%; left: 70%; width: 30px; height: 30px; border-radius: 50%; background: rgba(255,105,180,0.07);"></div>

                                            <!-- Roads -->
                                            <div style="position: absolute; top: 30%; left: 0; width: 100%; height: 2px; background: rgba(200,200,200,0.5);"></div>
                                            <div style="position: absolute; top: 0; left: 40%; width: 2px; height: 100%; background: rgba(200,200,200,0.5);"></div>
                                            <div style="position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: rgba(200,200,200,0.3);"></div>
                                            <div style="position: absolute; top: 0; left: 60%; width: 1px; height: 100%; background: rgba(200,200,200,0.3);"></div>
                                        </div>

                                        <!-- Location Marker -->
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                            <!-- Pulse Animation -->
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.3); animation: pulse 2s infinite;"></div>
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border-radius: 50%; background: rgba(255,105,180,0.5); animation: pulse 2s infinite 0.3s;"></div>

                                            <!-- Marker Pin -->
                                            <div style="position: relative; width: 30px, height: 30px;">
                                                <div style="position: absolute; top: 0; left: 0; width: 30px; height: 30px; background: #ff69b4; border-radius: 50%; box-shadow: 0 3px 8px rgba(0,0,0,0.3);"></div>
                                            </div>
                                        </div>

                                        <!-- Overlay with CTA -->
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.5); display: flex; flex-direction: column; align-items: center; justify-content: center; transition: background 0.3s ease;">
                                            <div class="text-center">
                                                <div style="width: 70px; height: 70px; background: #ff69b4; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 10px rgba(255,105,180,0.3);">
                                                    <i class="fa fa-map-marker fa-2x text-white"></i>
                                                </div>
                                                <h5 class="font-weight-bold mb-1" style="color: #333;">Our Location</h5>
                                                <t t-if="selected_branch">
                                                    <p class="text-muted mb-2">
                                                        <t t-if="selected_branch.street"><t t-esc="selected_branch.street"/></t>
                                                        <t t-if="selected_branch.city">, <t t-esc="selected_branch.city"/></t>
                                                    </p>
                                                </t>
                                                <t t-else="">
                                                    <p class="text-muted mb-2">Select a branch to view location</p>
                                                </t>
                                                <button class="btn" style="background: #ff69b4; color: white; border-radius: 20px; padding: 8px 20px; border: none; box-shadow: 0 2px 5px rgba(255,105,180,0.3); font-weight: 600;">
                                                    <i class="fa fa-directions mr-2"></i>Get Directions
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- Hours Section -->
                                        <div class="col-md-6 mb-4">
                                            <div class="hours-section" style="background: white; border-radius: 15px; padding: 20px; height: 100%; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 4px solid #ff69b4;">
                                                <div class="d-flex align-items-center mb-3">

                                                    <h5 class="font-weight-bold ml-3 mb-0">Hours of Operation</h5>
                                                </div>

                                                <div class="hours-list mt-3">
                                                    <t t-if="selected_branch">
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Monday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.monday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.monday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.monday_open), int((selected_branch.monday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.monday_close), int((selected_branch.monday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Tuesday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.tuesday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.tuesday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.tuesday_open), int((selected_branch.tuesday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.tuesday_close), int((selected_branch.tuesday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Wednesday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.wednesday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.wednesday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.wednesday_open), int((selected_branch.wednesday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.wednesday_close), int((selected_branch.wednesday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Thursday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.thursday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.thursday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.thursday_open), int((selected_branch.thursday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.thursday_close), int((selected_branch.thursday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Friday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.friday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.friday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.friday_open), int((selected_branch.friday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.friday_close), int((selected_branch.friday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Saturday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.saturday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.saturday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.saturday_open), int((selected_branch.saturday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.saturday_close), int((selected_branch.saturday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Sunday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.sunday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.sunday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.sunday_open), int((selected_branch.sunday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.sunday_close), int((selected_branch.sunday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="text-center p-3">
                                                            <p class="text-muted">Select a branch to view hours</p>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Contact Info with Unique Style -->
                                        <div class="col-md-6 mb-4">
                                            <div class="contact-section" style="background: white; border-radius: 15px; padding: 20px; height: 100%; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                                <div class="d-flex align-items-center mb-3">

                                                    <h5 class="font-weight-bold ml-3 mb-0">Contact Us</h5>
                                                </div>

                                                <div class="contact-list mt-3">
                                                    <t t-if="selected_branch">
                                                        <t t-if="selected_branch.phone">
                                                            <div class="contact-item d-flex align-items-center mb-3">
                                                                <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                    <i class="fa fa-phone" style="color: #ff69b4;"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="small text-muted">Phone</div>
                                                                    <div class="font-weight-bold"><t t-esc="selected_branch.phone"/></div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                        <t t-if="selected_branch.email">
                                                            <div class="contact-item d-flex align-items-center mb-3">
                                                                <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                    <i class="fa fa-envelope" style="color: #ff69b4;"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="small text-muted">Email</div>
                                                                    <div class="font-weight-bold"><t t-esc="selected_branch.email"/></div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                        <div class="contact-item d-flex align-items-center">
                                                            <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                <i class="fa fa-map-marker" style="color: #ff69b4;"></i>
                                                            </div>
                                                            <div>
                                                                <div class="small text-muted">Address</div>
                                                                <div class="font-weight-bold">
                                                                    <t t-if="selected_branch.street"><t t-esc="selected_branch.street"/></t>
                                                                    <t t-if="selected_branch.city">, <t t-esc="selected_branch.city"/></t>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="text-center p-3">
                                                            <p class="text-muted">Select a branch to view contact information</p>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <style>
                                @keyframes pulse {
                                    0% {
                                        transform: translate(-50%, -50%) scale(1);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(1.5);
                                        opacity: 0;
                                    }
                                }
                                .map-container:hover .map-overlay {
                                    background: rgba(255,255,255,0.3);
                                }
                                .map-container:hover button {
                                    transform: translateY(-3px);
                                    box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
                                }
                            </style>
                        </div>
                    </div>
                </div>

                <!-- Selection JavaScript -->
                <script>
                    let selectedStaff = null;
                    let selectedBranch = null;
                    
                    // Initialize selectedBranch from URL parameter
                    const urlParams = new URLSearchParams(window.location.search);
                    const branchIdFromUrl = urlParams.get('branch_id');
                    if (branchIdFromUrl) {
                        selectedBranch = branchIdFromUrl;
                    }

                    function selectStaff(element, staffId) {
                        // Remove previous selection
                        document.querySelectorAll('.staff-card .card').forEach(card => {
                            card.style.borderColor = '';
                            card.style.background = '';
                            card.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)';
                            card.style.transform = '';

                            // Hide selection indicator on all cards
                            const indicator = card.querySelector('.selection-indicator');
                            if (indicator) {
                                indicator.style.display = 'none';
                            }
                        });

                        // Highlight selected staff with enhanced styling
                        const card = element.querySelector('.card');
                        card.style.borderColor = '#ff69b4';
                        card.style.borderWidth = '3px';
                        card.style.background = '#fff0f7';
                        card.style.boxShadow = '0 8px 20px rgba(255,105,180,0.3)';
                        card.style.transform = 'translateY(-5px)';

                        // Show selection indicator for selected card
                        const indicator = card.querySelector('.selection-indicator');
                        if (indicator) {
                            indicator.style.display = 'block';
                        }

                        selectedStaff = staffId;

                        // Add continue button if not already present
                        if (!document.getElementById('continue-button')) {
                            const continueButton = document.createElement('div');
                            continueButton.id = 'continue-button';
                            continueButton.className = 'text-center mt-4 mb-4 container';
                            continueButton.innerHTML = `
                                <div class="row justify-content-center">
                                    <div class="col-12 col-md-8 col-lg-6">
                                        <button class="btn btn-lg w-100 continue-services-btn"
                                            style="background: #ff69b4; color: white; border: none; padding: 15px 25px;
                                            border-radius: 25px; font-weight: 600; transition: all 0.3s ease;
                                            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3); max-width: 100%;"
                                            onclick="proceedToServices()">
                                            <i class="fa fa-arrow-right mr-2"></i>
                                            Continue to Services
                                        </button>
                                    </div>
                                </div>
                                <style>
                                    @media (max-width: 767px) {
                                        .continue-services-btn {
                                            font-size: 16px;
                                            padding: 12px 20px !important;
                                        }
                                    }
                                    .continue-services-btn:hover {
                                        transform: translateY(-2px);
                                        box-shadow: 0 6px 15px rgba(255, 105, 180, 0.4);
                                        background: #ff4da9 !important;
                                    }
                                    .continue-services-btn:active {
                                        transform: translateY(1px);
                                        box-shadow: 0 2px 5px rgba(255, 105, 180, 0.4);
                                    }
                                </style>
                            `;
                            document.querySelector('.staff-grid').after(continueButton);
                        }
                    }

                    function selectBranch(element, branchId) {
                        selectedBranch = branchId;
                        // Preserve existing query params (like promo) when selecting branch
                        const params = new URLSearchParams(window.location.search);
                        params.set('branch_id', branchId);
                        window.location.href = '/appointments?' + params.toString();
                    }

                    function proceedToServices() {
                        if (!selectedStaff) {
                            alert('Please select a staff member before continuing.');
                            return;
                        }

                        const params = new URLSearchParams();
                        params.append('staff_id', selectedStaff);
                        if (selectedBranch) {
                            params.append('branch_id', selectedBranch);
                        }
                        // Preserve promo code from URL if present
                        const currentParams = new URLSearchParams(window.location.search);
                        const promo = currentParams.get('promo');
                        if (promo) {
                            params.append('promo', promo);
                        }

                        window.location.href = `/appointments/services?${params.toString()}`;
                    }
                </script>
            </div>
        </t>
    </template>

    <!-- Professional Service Selection Page -->
    <template id="service_selection_page" name="Select Services">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <!-- Hero Section with Background Image and Fade -->
                <div class="hero-section position-relative" style="padding: 40px 0; margin-bottom: 30px; overflow: hidden;">
                    <!-- Background image with fade effect -->
                    <div class="hero-bg-image-services"></div>
                    <div class="hero-bg-overlay"></div>

                    <div class="container position-relative" style="z-index: 2;">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="display-5 font-weight-bold text-dark mb-2">
                                    <t t-esc="request.env.company.name or 'Professional Services'"/>
                                    <t t-if="selected_branch"> - <t t-esc="selected_branch.name"/></t>
                                </h1>
                                <p class="text-muted mb-0">Select your preferred services</p>
                            </div>
                            <div class="col-md-4 text-right">
                                <a href="/appointments" class="btn" style="background: #ff69b4; color: white; border: none; padding: 10px 25px; border-radius: 20px; font-weight: 600; box-shadow: 0 4px 10px rgba(255,105,180,0.3);">
                                    <i class="fa fa-arrow-left mr-2"></i> Change branch
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    .hero-section {
                        min-height: 200px;
                        display: flex;
                        align-items: center;
                    }
                    .hero-bg-image-services {
                        position: absolute;
                        top: 0;
                        right: 0;
                        width: 100%;
                        height: 100%;
                        background-image: url('/custom_appointments/static/src/img/lashes.JPG');
                        background-size: cover;
                        background-position: center right;
                        z-index: 1;
                    }
                    .hero-bg-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(90deg,
                            rgba(255,255,255,1) 0%,
                            rgba(255,255,255,0.9) 30%,
                            rgba(255,255,255,0.6) 60%,
                            rgba(255,255,255,0) 100%);
                        z-index: 1;
                    }
                </style>

                <div class="container">
                    <!-- Selection Summary Panel (New) -->
                    <div class="selection-summary mb-4">
                        <div class="card shadow-sm border-0" style="border-radius: 15px; overflow: hidden;">
                            <div class="card-header bg-light p-3" style="background: #f8f9fa; border: none;">
                                <h5 class="font-weight-bold mb-0">
                                    <i class="fa fa-check-circle mr-2" style="color: #ff69b4;"></i>
                                    Your Selection Summary
                                </h5>
                            </div>
                            <div class="card-body p-3">
                                <div class="row">
                                    <!-- Branch Information -->
                                    <div class="col-md-6 mb-3 mb-md-0">
                                        <div class="selection-item p-3" style="background: #fff5f8; border-radius: 10px;">
                                            <div class="d-flex align-items-center">
                                                <div style="width: 45px; height: 45px; min-width: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 3px 8px rgba(0,0,0,0.1);">
                                                    <i class="fa fa-building" style="color: #ff69b4; font-size: 18px;"></i>
                                                </div>
                                                <div>
                                                    <div class="small text-muted">Selected Branch</div>
                                                    <div class="font-weight-bold" id="selected-branch-name">
                                                        <t t-if="selected_branch">
                                                            <t t-esc="selected_branch.name"/>
                                                        </t>
                                                        <t t-else="">
                                                            Main Branch
                                                        </t>
                                                    </div>
                                                    <div class="small text-muted" id="selected-branch-address">
                                                        <t t-if="selected_branch and selected_branch.street">
                                                            <t t-esc="selected_branch.street"/>
                                                        </t>
                                                        <t t-else="">
                                                            123 Main Street
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Staff Member Information -->
                                    <div class="col-md-6">
                                        <div class="selection-item p-3" style="background: #fff5f8; border-radius: 10px;">
                                            <div class="d-flex align-items-center">
                                                <div id="staff-avatar" style="width: 45px; height: 45px; min-width: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); overflow: hidden;">
                                                    <t t-if="selected_staff and selected_staff.image">
                                                        <img t-att-src="'/web/image/custom.staff.member/%s/image/90x90' % selected_staff.id"
                                                             style="width: 100%; height: 100%; object-fit: cover;"
                                                             alt="Staff Photo"/>
                                                    </t>
                                                    <t t-else="">
                                                        <i class="fa fa-user" style="color: #ff69b4; font-size: 18px;"></i>
                                                    </t>
                                                </div>
                                                <div>
                                                    <div class="small text-muted">Selected Specialist</div>
                                                    <div class="font-weight-bold" id="selected-staff-name">
                                                        <t t-if="selected_staff">
                                                            <t t-esc="selected_staff.name"/>
                                                        </t>
                                                        <t t-else="">
                                                            Any Available Staff
                                                        </t>
                                                    </div>
                                                    <div class="small text-muted" id="selected-staff-specialization">
                                                        <t t-if="selected_staff and selected_staff.specialization">
                                                            <t t-esc="selected_staff.specialization"/>
                                                        </t>
                                                        <t t-else="">
                                                            Professional Specialist
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Selection -->
                    <div class="service-selection">
                        <div class="row">
                            <div class="col-12">
                                <!-- Search Bar with Enhanced Styling -->
                                <div class="service-search-section mb-4">
                                    <h3 class="text-center font-weight-bold mb-2 mt-4" style="color: #333;">
                                       Select Your Service
                                    </h3>
                                    <div class="card shadow-sm border-0" style="border-radius: 15px; background: linear-gradient(to right, #fff5f8, #fff);">
                                        <div class="card-body p-4">
                                            <div class="row justify-content-center">
                                                <div class="col-md-8">
                                                    <div class="search-input-group">
                                                        <div class="input-group">

                                                            <input type="text" class="form-control border-left-0" placeholder="Search for services by name or description..."
                                                                   style="border-radius: 25px 25px 25px 25px; padding: 15px; border-color: #ff69b4; box-shadow: 0 3px 10px rgba(255,105,180,0.1);"
                                                                   id="service-search" onkeyup="searchServices(this.value)"/>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Services by Category -->
                                <t t-if="service_categories and services">
                                    <t t-foreach="service_categories" t-as="category">
                                        <t t-if="services.filtered(lambda s: s.category_id.id == category.id)">
                                            <div class="category-section mb-5">
                                                <!-- Category Header with Enhanced Styling -->
                                                <div class="category-header mb-4 p-3" style="background: linear-gradient(135deg, #fff5f8, #fff); border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 4px solid #ff69b4; position: relative; overflow: hidden;">
                                                    <div class="category-decoration" style="position: absolute; top: -15px; right: -15px; width: 100px; height: 100px; border-radius: 50%; background: rgba(255,105,180,0.03); z-index: 1;"></div>
                                                    <div class="d-flex align-items-center position-relative" style="z-index: 2;">
                                                        <div style="width: 40px; height: 40px; min-width: 40px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 3px 8px rgba(0,0,0,0.1);">
                                                            <t t-if="category.image">
                                                                <img t-att-src="'/web/image/service.category/%s/image/40x40' % category.id"
                                                                    class="rounded-circle"
                                                                    style="width: 30px; height: 30px; object-fit: cover;"
                                                                    alt="Category"/>
                                                            </t>
                                                            <t t-else="">
                                                                <i class="fa fa-list" style="color: #ff69b4; font-size: 16px;"></i>
                                                            </t>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-weight-bold mb-0"><t t-esc="category.name"/></h4>
                                                            <t t-if="services.filtered(lambda s: s.category_id.id == category.id)">
                                                                <p class="text-muted mb-0 small">
                                                                    <t t-esc="len(services.filtered(lambda s: s.category_id.id == category.id))"/> services available
                                                                </p>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Services in Category with Grid Layout -->
                                                <div class="services-list">
                                                    <div class="row">
                                                        <t t-foreach="services.filtered(lambda s: s.category_id.id == category.id)" t-as="service">
                                                            <div class="col-lg-6 col-md-12 mb-4">
                                                                <div class="service-item h-100" style="background: white; border: none; border-radius: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 3px 15px rgba(0,0,0,0.05);" t-att-onclick="'selectService(this, ' + str(service.id) + ')'">
                                                                    <div class="card border-0 h-100">
                                                                        <div class="card-body p-0">
                                                                            <div class="row no-gutters h-100">
                                                                                <!-- Service Image Section -->
                                                                                <div class="col-md-4 service-image-container position-relative d-none d-md-block">
                                                                                    <t t-if="service.image">
                                                                                        <div class="service-image h-100" style="border-radius: 16px 0 0 16px; overflow: hidden;">
                                                                                            <img t-att-src="'/web/image/company.service/%s/image/200x200' % service.id"
                                                                                                style="width: 100%; height: 100%; object-fit: cover;"
                                                                                                alt="Service Image"/>
                                                                                            <!-- Image overlay -->
                                                                                            <div class="service-image-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(255,105,180,0.3) 0%, rgba(255,105,180,0) 50%); border-radius: 16px 0 0 16px;"></div>
                                                                                        </div>
                                                                                    </t>
                                                                                    <t t-else="">
                                                                                        <div class="service-image-placeholder h-100 d-flex align-items-center justify-content-center"
                                                                                            style="background: linear-gradient(135deg, #fff5f8, #ffd6e7); border-radius: 16px 0 0 16px;">
                                                                                            <i class="fa fa-spa text-pink" style="font-size: 32px; color: #ff69b4; opacity: 0.5;"></i>
                                                                                        </div>
                                                                                    </t>
                                                                                </div>

                                                                                <!-- Service Content Section -->
                                                                                <div class="col-md-8">
                                                                                    <div class="service-content p-4">
                                                                                        <h5 class="font-weight-bold mb-2 service-title">
                                                                                            <t t-esc="service.name"/>
                                                                                        </h5>

                                                                                        <!-- Service Description -->
                                                                                        <t t-if="service.description">
                                                                                            <p class="text-muted mb-3 service-description small">
                                                                                                <t t-esc="service.description[:100]"/>
                                                                                                <t t-if="len(service.description) > 100">...</t>
                                                                                            </p>
                                                                                        </t>

                                                                                        <!-- Service Details with Enhanced Icons -->
                                                                                        <div class="service-details d-flex flex-wrap mb-3">
                                                                                            <span class="badge mr-2 mb-2" style="background: #fff5f8; color: #ff69b4; border-radius: 30px; padding: 8px 15px; font-weight: normal;">
                                                                                                <i class="fa fa-clock-o mr-1"></i>
                                                                                                <t t-esc="service.duration"/> hour<t t-if="service.duration != 1">s</t>
                                                                                            </span>
                                                                                            <t t-if="service.category_id">
                                                                                                <span class="badge mr-2 mb-2" style="background: #f0f0f0; color: #666; border-radius: 30px; padding: 8px 15px; font-weight: normal;">
                                                                                                    <i class="fa fa-tag mr-1"></i>
                                                                                                    <t t-esc="service.category_id.name"/>
                                                                                                </span>
                                                                                            </t>
                                                                                        </div>

                                                                                        <!-- Price and Selection with Enhanced Styling -->
                                                                                        <div class="d-flex justify-content-between align-items-center">
                                                                                            <div class="service-price">
                                                                                                <t t-if="service.fee_type == 'partial' and service.booking_fee > 0">
                                                                                                    <span class="text-muted small mr-1">booking fee</span>
                                                                                                    <span class="price font-weight-bold" style="color: #ff69b4; font-size: 1.25rem;">
                                                                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.booking_fee"/>
                                                                                                    </span>
                                                                                                    <br/>
                                                                                                    <span class="text-muted small">Full price: <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/></span>
                                                                                                </t>
                                                                                                <t t-else="">
                                                                                                    <span class="text-muted small mr-1">from</span>
                                                                                                    <span class="price font-weight-bold" style="color: #ff69b4; font-size: 1.25rem;">
                                                                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/>
                                                                                                    </span>
                                                                                                </t>
                                                                                            </div>
                                                                                            <div class="service-selection">
                                                                                                <div class="selection-checkbox position-relative">
                                                                                                    <input type="radio" name="selected_service" t-att-value="service.id"
                                                                                                           t-att-id="'service-' + str(service.id)" class="custom-control-input position-absolute invisible"
                                                                                                           style="opacity: 0; cursor: pointer;"/>
                                                                                                    <label class="select-btn" t-att-for="'service-' + str(service.id)"
                                                                                                           style="background: transparent; border: 2px solid #ff69b4; color: #ff69b4;
                                                                                                                  border-radius: 20px; padding: 6px 16px; font-weight: 600;
                                                                                                                  cursor: pointer; transition: all 0.3s ease;">
                                                                                                        Select
                                                                                                    </label>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </t>
                                </t>
                                <t t-else="">
                                    <div class="text-center py-5">
                                        <i class="fa fa-list fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted">No Services Available</h5>
                                        <p class="text-muted">Please contact us directly for service information.</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Continue Button with Enhanced Styling -->
                    <div class="text-center mt-5 mb-5">
                        <button class="btn btn-lg"
                                style="background: #ff69b4; color: white; border: none; padding: 15px 40px; border-radius: 25px; font-weight: 600; box-shadow: 0 5px 15px rgba(255,105,180,0.3); transition: all 0.3s ease;"
                                onclick="proceedToBooking()">
                            <i class="fa fa-calendar-check-o mr-2"></i> Continue to Booking
                        </button>
                    </div>
                </div>

                <!-- Location Details Section -->
                <div class="container mb-5">
                    <div class="row">
                        <div class="col-lg-12 mb-4">
                            <div class="location-card shadow-sm border-0" style="border-radius: 20px; overflow: hidden; background-image: linear-gradient(to right, #fff, #fff5f8); position: relative;">
                                <!-- Decorative Elements -->
                                <div class="decorative-circle" style="position: absolute; top: -30px; right: -30px; width: 120px; height: 120px; border-radius: 50%; background: rgba(255,105,180,0.1); z-index: 1;"></div>
                                <div class="decorative-circle" style="position: absolute; bottom: -20px; left: -40px; width: 100px; height: 100px; border-radius: 50%; background: rgba(255,105,180,0.08); z-index: 1;"></div>

                                <div class="card-body p-4" style="position: relative; z-index: 2;">
                                    <!-- Full-width Map Placeholder with Enhanced Styling -->
                                    <div class="map-container mb-4" style="position: relative; height: 280px; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.08);">
                                        <!-- Map Background -->
                                        <div class="map-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #f8f9fa, #fff);">
                                            <!-- Decorative Map Elements -->
                                            <div style="position: absolute; top: 20%; left: 30%; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,105,180,0.1);"></div>
                                            <div style="position: absolute; top: 60%; left: 20%; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.05);"></div>
                                            <div style="position: absolute; top: 40%; left: 70%; width: 30px; height: 30px; border-radius: 50%; background: rgba(255,105,180,0.07);"></div>

                                            <!-- Roads -->
                                            <div style="position: absolute; top: 30%; left: 0; width: 100%; height: 2px; background: rgba(200,200,200,0.5);"></div>
                                            <div style="position: absolute; top: 0; left: 40%; width: 2px; height: 100%; background: rgba(200,200,200,0.5);"></div>
                                            <div style="position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: rgba(200,200,200,0.3);"></div>
                                            <div style="position: absolute; top: 0; left: 60%; width: 1px; height: 100%; background: rgba(200,200,200,0.3);"></div>
                                        </div>

                                        <!-- Location Marker -->
                                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                            <!-- Pulse Animation -->
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.3); animation: pulse 2s infinite;"></div>
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border-radius: 50%; background: rgba(255,105,180,0.5); animation: pulse 2s infinite 0.3s;"></div>

                                            <!-- Marker Pin -->
                                            <div style="position: relative; width: 30px, height: 30px;">
                                                <div style="position: absolute; top: 0; left: 0; width: 30px; height: 30px; background: #ff69b4; border-radius: 50%; box-shadow: 0 3px 8px rgba(0,0,0,0.3);"></div>
                                            </div>
                                        </div>

                                        <!-- Overlay with CTA -->
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.5); display: flex; flex-direction: column; align-items: center; justify-content: center; transition: background 0.3s ease;">
                                            <div class="text-center">
                                                <div style="width: 70px; height: 70px; background: #ff69b4; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; box-shadow: 0 4px 10px rgba(255,105,180,0.3);">
                                                    <i class="fa fa-map-marker fa-2x text-white"></i>
                                                </div>
                                                <h5 class="font-weight-bold mb-1" style="color: #333;">Our Location</h5>
                                                <t t-if="selected_branch">
                                                    <p class="text-muted mb-2">
                                                        <t t-if="selected_branch.street"><t t-esc="selected_branch.street"/></t>
                                                        <t t-if="selected_branch.city">, <t t-esc="selected_branch.city"/></t>
                                                    </p>
                                                </t>
                                                <t t-else="">
                                                    <p class="text-muted mb-2">Select a branch to view location</p>
                                                </t>
                                                <button class="btn" style="background: #ff69b4; color: white; border-radius: 20px; padding: 8px 20px; border: none; box-shadow: 0 2px 5px rgba(255,105,180,0.3); font-weight: 600;">
                                                    <i class="fa fa-directions mr-2"></i>Get Directions
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- Hours Section -->
                                        <div class="col-md-6 mb-4">
                                            <div class="hours-section" style="background: white; border-radius: 15px; padding: 20px; height: 100%; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 4px solid #ff69b4;">
                                                <div class="d-flex align-items-center mb-3">
                                                    <h5 class="font-weight-bold ml-3 mb-0">Hours of Operation</h5>
                                                </div>

                                                <div class="hours-list mt-3">
                                                    <t t-if="selected_branch">
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Monday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.monday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.monday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.monday_open), int((selected_branch.monday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.monday_close), int((selected_branch.monday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Tuesday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.tuesday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.tuesday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.tuesday_open), int((selected_branch.tuesday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.tuesday_close), int((selected_branch.tuesday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Wednesday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.wednesday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.wednesday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.wednesday_open), int((selected_branch.wednesday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.wednesday_close), int((selected_branch.wednesday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Thursday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.thursday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.thursday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.thursday_open), int((selected_branch.thursday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.thursday_close), int((selected_branch.thursday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Friday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.friday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.friday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.friday_open), int((selected_branch.friday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.friday_close), int((selected_branch.friday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2 mb-2" style="border-bottom: 1px dashed #f0f0f0;">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Saturday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.saturday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.saturday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.saturday_open), int((selected_branch.saturday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.saturday_close), int((selected_branch.saturday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                        <div class="hour-item d-flex justify-content-between align-items-center p-2">
                                                            <div class="day-label">
                                                                <span class="font-weight-bold">Sunday</span>
                                                            </div>
                                                            <div class="hours-value" t-att-style="'color: ' + ('#ff69b4' if selected_branch.sunday_open > 0 else '#888') + '; font-weight: 600;'">
                                                                <t t-if="selected_branch.sunday_open > 0">
                                                                    <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.sunday_open), int((selected_branch.sunday_open % 1) * 60))"/> - <t t-esc="'{:02d}:{:02d}'.format(int(selected_branch.sunday_close), int((selected_branch.sunday_close % 1) * 60))"/>
                                                                </t>
                                                                <t t-else="">Closed</t>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="text-center p-3">
                                                            <p class="text-muted">Select a branch to view hours</p>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Contact Info with Unique Style -->
                                        <div class="col-md-6 mb-4">
                                            <div class="contact-section" style="background: white; border-radius: 15px; padding: 20px; height: 100%; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                                                <div class="d-flex align-items-center mb-3">
                                                    <h5 class="font-weight-bold ml-3 mb-0">Contact Us</h5>
                                                </div>

                                                <div class="contact-list mt-3">
                                                    <t t-if="selected_branch">
                                                        <t t-if="selected_branch.phone">
                                                            <div class="contact-item d-flex align-items-center mb-3">
                                                                <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                    <i class="fa fa-phone" style="color: #ff69b4;"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="small text-muted">Phone</div>
                                                                    <div class="font-weight-bold"><t t-esc="selected_branch.phone"/></div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                        <t t-if="selected_branch.email">
                                                            <div class="contact-item d-flex align-items-center mb-3">
                                                                <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                    <i class="fa fa-envelope" style="color: #ff69b4;"></i>
                                                                </div>
                                                                <div>
                                                                    <div class="small text-muted">Email</div>
                                                                    <div class="font-weight-bold"><t t-esc="selected_branch.email"/></div>
                                                                </div>
                                                            </div>
                                                        </t>
                                                        <div class="contact-item d-flex align-items-center">
                                                            <div style="width: 36px; height: 36px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                                                <i class="fa fa-map-marker" style="color: #ff69b4;"></i>
                                                            </div>
                                                            <div>
                                                                <div class="small text-muted">Address</div>
                                                                <div class="font-weight-bold">
                                                                    <t t-if="selected_branch.street"><t t-esc="selected_branch.street"/></t>
                                                                    <t t-if="selected_branch.city">, <t t-esc="selected_branch.city"/></t>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="text-center p-3">
                                                            <p class="text-muted">Select a branch to view contact information</p>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <style>
                                @keyframes pulse {
                                    0% {
                                        transform: translate(-50%, -50%) scale(1);
                                        opacity: 1;
                                    }
                                    100% {
                                        transform: translate(-50%, -50%) scale(1.5);
                                        opacity: 0;
                                    }
                                }
                                .map-container:hover .map-overlay {
                                    background: rgba(255,255,255,0.3);
                                }
                            </style>
                        </div>
                    </div>
                </div>

                <!-- JavaScript for Service Selection with Enhanced Interaction -->
                <script>
                    let selectedTeamMember = 'any';
                    let defaultStaffId = '1';
                    let selectedService = null;

                    function selectTeamMember(element, memberId) {
                        document.querySelectorAll('.team-card .card').forEach(card => {
                            card.style.borderColor = '';
                            card.style.background = '';
                        });
                        
                        const card = element.querySelector('.card');
                        card.style.borderColor = '#ff69b4';
                        card.style.background = '#fff5f8';
                        
                        selectedTeamMember = memberId;
                    }

                    function selectService(element, serviceId) {
                        // Reset all services
                        document.querySelectorAll('.service-item').forEach(item => {
                            item.style.boxShadow = '0 3px 15px rgba(0,0,0,0.05)';
                            item.style.transform = '';
                            item.style.borderColor = 'transparent';
                            item.style.background = 'white';

                            // Reset all select buttons
                            const selectBtn = item.querySelector('.select-btn');
                            if (selectBtn) {
                                selectBtn.style.background = 'transparent';
                                selectBtn.style.color = '#ff69b4';
                                selectBtn.style.borderColor = '#ff69b4';
                                selectBtn.textContent = 'Select';
                            }

                            const radio = item.querySelector('input[type="radio"]');
                            if (radio) radio.checked = false;
                        });

                        // Apply selection styling
                        element.style.boxShadow = '0 8px 20px rgba(255,105,180,0.2)';
                        element.style.transform = 'translateY(-3px)';
                        element.style.borderLeft = '4px solid #ff69b4';
                        element.style.background = '#fff5f8';
                        
                        // Apply selection styling to the button
                        const selectBtn = element.querySelector('.select-btn');
                        if (selectBtn) {
                            selectBtn.style.background = '#ff69b4';
                            selectBtn.style.color = 'white';
                            selectBtn.style.borderColor = '#ff69b4';
                            selectBtn.textContent = 'Selected';
                        }

                        const radio = element.querySelector('input[type="radio"]');
                        if (radio) radio.checked = true;

                        selectedService = serviceId;
                    }

                    function searchServices(query) {
                        if (!query) {
                            // If search is empty, show all services
                            document.querySelectorAll('.service-item').forEach(item => {
                                item.parentElement.style.display = 'block';
                            });
                            return;
                        }

                        query = query.toLowerCase();

                        document.querySelectorAll('.service-item').forEach(item => {
                            // Safely get title text
                            const titleElement = item.querySelector('.service-title');
                            const title = titleElement ? titleElement.textContent.toLowerCase() : '';

                            // Safely get description text
                            const descElement = item.querySelector('.service-description');
                            const desc = descElement ? descElement.textContent.toLowerCase() : '';

                            const searchText = title + ' ' + desc;

                            if (searchText.includes(query)) {
                                item.parentElement.style.display = 'block';
                            } else {
                                item.parentElement.style.display = 'none';
                            }
                        });
                    }

                    function proceedToBooking() {
                        if (!selectedService) {
                            alert('Please select a service before continuing.');
                            return;
                        }
                        
                        const staffParam = selectedTeamMember === 'any' ? defaultStaffId : selectedTeamMember;
                        let url = '/appointments/book?service_id=' + selectedService + '&amp;staff_id=' + staffParam;
                        // Preserve promo code from URL if present
                        const urlParams = new URLSearchParams(window.location.search);
                        const promo = urlParams.get('promo');
                        if (promo) {
                            url += '&amp;promo=' + encodeURIComponent(promo);
                        }
                        window.location.href = url;
                    }

                    document.addEventListener('DOMContentLoaded', function() {
                        const urlParams = new URLSearchParams(window.location.search);
                        const staffId = urlParams.get('staff_id');
                        if (staffId) {
                            selectedTeamMember = staffId;
                            defaultStaffId = staffId;
                        }
                    });
                </script>
            </div>
        </t>
    </template>

    <!-- Professional Booking Form Page -->
    <template id="booking_form_page" name="Book Appointment">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <!-- FullCalendar CSS -->
                <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet"/>
                
                <!-- Hero Section -->
                <div class="hero-section" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 40px 0; margin-bottom: 30px;">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="display-5 font-weight-bold text-dark mb-2">Book Your Appointment</h1>
                                <p class="text-muted mb-0">Select your preferred date and time</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div class="row">
                        <!-- Left Panel - Calendar -->
                        <div class="col-lg-8 mb-4">
                            <div class="card shadow-sm border-0" style="border-radius: 15px; overflow: hidden;">
                                <div class="card-header bg-gradient-primary text-white p-4" style="background: linear-gradient(135deg, #ff69b4, #ff8da1); border: none;">
                                    <h4 class="font-weight-bold mb-0">Select Date &amp; Time</h4>
                                    <p class="mb-0 opacity-75">Click on a date to view available time slots</p>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Calendar Container -->
                                    <div id="calendar" style="min-height: 500px;"></div>
                                    
                                    <!-- Time Slots Container (shown after date selection) -->
                                    <div id="time-slots-section" style="display: none; margin-top: 30px;">
                                        <div class="date-header p-3 mb-3" style="background: linear-gradient(135deg, #fff5f8, #fff); border-radius: 12px; border-left: 4px solid #ff69b4;">
                                            <h5 class="font-weight-bold mb-0" style="color: #333;">
                                                <i class="fa fa-clock-o mr-2" style="color: #ff69b4;"></i>
                                                Available Times for <span id="selected-date-display"></span>
                                            </h5>
                                        </div>
                                        <div id="time-slots-container" class="row">
                                            <!-- Time slots will be dynamically loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Panel - Booking Summary & Customer Info -->
                        <div class="col-lg-4 mb-4">
                            <div class="card shadow-sm border-0" style="border-radius: 18px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.08);">
                                <!-- Summary Card Header with Gradient -->
                                <div class="card-header p-4" style="background: linear-gradient(135deg, #ff69b4, #ff8da1); border: none;">
                                    <h5 class="font-weight-bold text-white mb-0">
                                        <i class="fa fa-clipboard-list mr-2"></i>
                                        Booking Summary
                                    </h5>
                                </div>
                                <div class="card-body p-4">
                                    <!-- Booking Summary -->
                                    <div class="booking-summary mb-4">
                                        <!-- Service Details with Enhanced Styling -->
                                        <div class="summary-item mb-4 service-summary" style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border-left: 4px solid #ff69b4; position: relative; overflow: hidden;">
                                            <!-- Decorative Element -->
                                            <div style="position: absolute; top: -20px; right: -20px; width: 80px; height: 80px; border-radius: 50%; background: rgba(255,105,180,0.05); z-index: 1;"></div>

                                            <div class="d-flex align-items-center p-3 position-relative" style="z-index: 2;">
                                                <t t-if="service.image">
                                                    <div style="width: 60px; height: 60px; min-width: 60px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-right: 15px; background: #f8f9fa;">
                                                        <img t-att-src="'/web/image/company.service/%s/image/60x60' % service.id"
                                                             style="width: 100%; height: 100%; object-fit: cover;"
                                                             alt="Service Image"/>
                                                    </div>
                                                </t>
                                                <t t-else="">
                                                    <div style="width: 60px; height: 60px; min-width: 60px; background: #fff5f8; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
                                                        <i class="fa fa-spa" style="color: #ff69b4; font-size: 24px;"></i>
                                                    </div>
                                                </t>
                                                <div class="flex-grow-1">
                                                    <span class="d-block small text-muted mb-1" style="text-transform: uppercase; letter-spacing: 0.5px;">Service</span>
                                                    <h6 class="font-weight-bold mb-1" style="color: #333;"><t t-esc="service.name"/></h6>
                                                    <div class="d-flex align-items-center">
                                                        <span class="badge mr-2" style="background: #fff5f8; color: #ff69b4; border-radius: 30px; padding: 5px 10px; font-weight: normal;">
                                                            <i class="fa fa-clock-o mr-1"></i><t t-esc="service.duration"/>h
                                                        </span>
                                                        <t t-if="service.fee_type == 'partial' and service.booking_fee > 0">
                                                            <div class="d-flex flex-column">
                                                                <span class="price font-weight-bold" style="color: #ff69b4;">
                                                                    <t t-esc="service.currency_id.symbol"/><t t-esc="service.booking_fee"/> <small class="text-muted">(booking fee)</small>
                                                                </span>
                                                                <small class="text-muted">Full: <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/></small>
                                                            </div>
                                                        </t>
                                                        <t t-else="">
                                                            <span class="price font-weight-bold" style="color: #ff69b4;">
                                                                <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/>
                                                            </span>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Staff Member Details with Enhanced Styling -->
                                        <div class="summary-item mb-4 staff-summary" style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border-left: 4px solid #ff69b4; position: relative; overflow: hidden;">
                                            <!-- Decorative Element -->
                                            <div style="position: absolute; top: -15px; right: -15px; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.05); z-index: 1;"></div>

                                            <div class="d-flex align-items-center p-3 position-relative" style="z-index: 2;">
                                                <t t-if="staff.image">
                                                    <div style="width: 60px; height: 60px; min-width: 60px; border-radius: 50%; overflow: hidden; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-right: 15px;">
                                                        <img t-att-src="'/web/image/custom.staff.member/%s/image/60x60' % staff.id"
                                                             style="width: 100%; height: 100%; object-fit: cover;"
                                                             alt="Staff Photo"/>
                                                    </div>
                                                </t>
                                                <t t-else="">
                                                    <div style="width: 60px; height: 60px; min-width: 60px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); border: 3px solid white;">
                                                        <i class="fa fa-user" style="color: #ff69b4; font-size: 24px;"></i>
                                                    </div>
                                                </t>
                                                <div class="flex-grow-1">
                                                    <span class="d-block small text-muted mb-1" style="text-transform: uppercase; letter-spacing: 0.5px;">Specialist</span>
                                                    <h6 class="font-weight-bold mb-1" style="color: #333;"><t t-esc="staff.name"/></h6>
                                                    <t t-if="staff.specialization">
                                                        <p class="text-muted small mb-0" style="font-style: italic;"><t t-esc="staff.specialization"/></p>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Selected Time with Enhanced Styling -->
                                        <div class="selected-time-display mb-4" style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 2px dashed #ff69b4; padding: 15px; display: none; position: relative; overflow: hidden;">
                                            <!-- Decorative Elements -->
                                            <div style="position: absolute; top: -15px; left: -15px; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,105,180,0.05); z-index: 1;"></div>
                                            <div style="position: absolute; bottom: -20px; right: -20px; width: 80px; height: 80px; border-radius: 50%; background: rgba(255,105,180,0.05); z-index: 1;"></div>

                                            <div class="position-relative" style="z-index: 2;">
                                                <div class="d-flex align-items-center mb-2">
                                                    <div style="width: 40px; height: 40px; min-width: 40px; background: #fff5f8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                                        <i class="fa fa-calendar-check-o" style="color: #ff69b4; font-size: 18px;"></i>
                                                    </div>
                                                    <span class="d-block text-muted" style="text-transform: uppercase; letter-spacing: 0.5px; font-size: 12px;">Selected Date &amp; Time</span>
                                                </div>
                                                <div class="selected-time-content pl-4 ml-2 mt-2 border-left" style="border-color: #ff69b4 !important;">
                                                    <h6 class="font-weight-bold" style="color: #ff69b4;" id="selected-time-text">Please select a time slot</h6>
                                                    <p class="small text-muted mb-0">Duration: <t t-esc="service.duration"/> hour<t t-if="service.duration != 1">s</t></p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Total Price Summary -->
                                        <div class="summary-total p-3 mb-4" style="background: #fff5f8; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.03);">
                                            <t t-if="service.fee_type == 'partial' and service.booking_fee > 0">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="font-weight-bold" style="color: #333; font-size: 14px;">Booking Fee (Pay Now)</span>
                                                    <span class="price font-weight-bold" style="color: #ff69b4; font-size: 18px;">
                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.booking_fee"/>
                                                    </span>
                                                </div>
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span class="text-muted" style="font-size: 14px;">Balance Due at Appointment</span>
                                                    <span class="text-muted" style="font-size: 14px;">
                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.price - service.booking_fee"/>
                                                    </span>
                                                </div>
                                                <hr class="my-2"/>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="font-weight-bold" style="color: #333; font-size: 16px;">Total Price</span>
                                                    <span class="font-weight-bold" style="color: #333; font-size: 18px;">
                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/>
                                                    </span>
                                                </div>
                                            </t>
                                            <t t-else="">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <span class="font-weight-bold" style="color: #333; font-size: 16px;">Total</span>
                                                    <span class="price font-weight-bold" style="color: #ff69b4; font-size: 20px;">
                                                        <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/>
                                                    </span>
                                                </div>
                                            </t>
                                        </div>
                                    </div>

                                    <!-- Customer Information Form -->
                                    <div class="customer-form-section">
                                        <h5 class="font-weight-bold mb-3" style="color: #333; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                            <i class="fa fa-user-circle mr-2" style="color: #ff69b4;"></i>
                                            Your Information
                                        </h5>
                                        <form id="booking-form" method="post" t-attf-action="/appointments/book?service_id={{service.id}}&amp;staff_id={{staff.id}}">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <input type="hidden" name="service_id" t-att-value="service.id"/>
                                            <input type="hidden" name="staff_id" t-att-value="staff.id"/>
                                            <input type="hidden" name="appointment_datetime" id="appointment_datetime"/>

                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold small" style="color: #555;">Full Name *</label>
                                                <input type="text" class="form-control" name="customer_name" required="" style="border-radius: 10px; padding: 12px; border-color: #e0e0e0;"/>
                                            </div>

                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold small" style="color: #555;">Email Address *</label>
                                                <input type="email" class="form-control" name="customer_email" required="" style="border-radius: 10px; padding: 12px; border-color: #e0e0e0;"/>
                                            </div>

                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold small" style="color: #555;">Phone Number</label>
                                                <input type="tel" class="form-control" name="customer_phone" style="border-radius: 10px; padding: 12px; border-color: #e0e0e0;"/>
                                            </div>

                                            <div class="form-group mb-3">
                                                <label class="font-weight-bold small" style="color: #555;">
                                                    <i class="fa fa-ticket mr-1" style="color: #ff69b4;"></i>
                                                    Promo Code
                                                </label>
                                                <div class="input-group" style="display: flex; align-items: stretch;">
                                                    <input type="text" class="form-control" name="promo_code" id="promo_code" 
                                                           placeholder="Enter promo code (optional)" 
                                                           style="border-radius: 10px 0 0 10px; padding: 12px; border-color: #e0e0e0; flex: 1;"/>
                                                    <button type="button" class="btn" onclick="validatePromoCode()" 
                                                            style="background: #ff69b4; color: white; border-radius: 0 10px 10px 0; padding: 12px 20px; border: none; height: auto;">
                                                        Apply
                                                    </button>
                                                </div>
                                                <div id="promo-feedback" class="mt-2" style="display: none;"></div>
                                            </div>

                                            <div class="form-group mb-4">
                                                <label class="font-weight-bold small" style="color: #555;">Special Requests</label>
                                                <textarea class="form-control" name="notes" rows="3" placeholder="Any special requests or notes..." style="border-radius: 10px; padding: 12px; border-color: #e0e0e0;"></textarea>
                                            </div>

                                            <button type="submit" class="btn btn-lg w-100" style="background: #ff69b4; color: white; border: none; padding: 15px; border-radius: 25px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(255,105,180,0.3);" disabled="" id="book-btn">
                                                <i class="fa fa-calendar-check-o mr-2"></i>
                                                Book Appointment
                                            </button>
                                            <p class="text-center text-muted small mt-2">You'll receive a confirmation email with your booking details</p>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FullCalendar JavaScript -->
                <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
                
                <!-- Custom Booking JavaScript -->
                <script>
                    let selectedDateTime = null;
                    let calendar = null;
                    let availableSlotsData = <t t-raw="available_slots_json or '{}'"/>;

                    function selectTimeSlot(button, datetime, displayTime) {
                        // Remove previous selection
                        document.querySelectorAll('.time-slot-btn').forEach(btn => {
                            btn.classList.remove('btn-primary');
                            btn.classList.add('btn-outline-primary');
                        });
                        
                        // Highlight selected slot
                        button.classList.remove('btn-outline-primary');
                        button.classList.add('btn-primary');
                        
                        // Update selected time display
                        selectedDateTime = datetime;
                        document.getElementById('appointment_datetime').value = datetime;
                        
                        const timeDisplay = document.querySelector('.selected-time-display');
                        const timeText = document.getElementById('selected-time-text');
                        
                        // Parse the datetime to get the date, but use the displayTime for the time portion
                        const date = new Date(datetime);
                        const dayName = getDayName(date);
                        const formattedTime = dayName + ', ' + date.toLocaleDateString() + ' at ' + displayTime;
                        timeText.textContent = formattedTime;
                        timeDisplay.style.display = 'block';
                        
                        // Enable book button
                        document.getElementById('book-btn').disabled = false;
                        
                        // Scroll to booking form
                        document.querySelector('.customer-form-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }

                    function getDayName(date) {
                        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                        return days[date.getDay()];
                    }

                    function formatDateDisplay(dateStr) {
                        const date = new Date(dateStr);
                        const dayName = getDayName(date);
                        return `${dayName}, ${date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}`;
                    }

                    function getLocalDateString(date) {
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}-${month}-${day}`;
                    }

                    function loadTimeSlotsForDate(dateStr) {
                        const timeSlotsSection = document.getElementById('time-slots-section');
                        const timeSlotsContainer = document.getElementById('time-slots-container');
                        const dateDisplay = document.getElementById('selected-date-display');
                        
                        // Show the time slots section
                        timeSlotsSection.style.display = 'block';
                        dateDisplay.textContent = formatDateDisplay(dateStr);
                        
                        // Get slots for this date
                        const slots = availableSlotsData[dateStr] || [];
                        
                        if (slots.length === 0) {
                            timeSlotsContainer.innerHTML = '<div class="col-12 text-center p-4"><p class="text-muted">No available time slots for this date.</p></div>';
                            return;
                        }
                        
                        // Build time slots HTML
                        let slotsHTML = '';
                        slots.forEach(slot => {
                            slotsHTML += `
                                <div class="col-md-3 col-sm-4 col-6 mb-3">
                                    <button class="btn btn-outline-primary time-slot-btn w-100"
                                            style="border-radius: 20px; padding: 12px; transition: all 0.3s ease; border-color: #ff69b4; color: #ff69b4; font-weight: 500;"
                                            onclick="selectTimeSlot(this, '${slot.datetime}', '${slot.display_time}')">
                                        <i class="fa fa-clock-o mr-1"></i>
                                        ${slot.display_time}
                                    </button>
                                </div>
                            `;
                        });
                        
                        timeSlotsContainer.innerHTML = slotsHTML;
                        
                        // Scroll to time slots
                        timeSlotsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }

                    // Initialize FullCalendar
                    document.addEventListener('DOMContentLoaded', function() {
                        const calendarEl = document.getElementById('calendar');
                        
                        // Prepare events for calendar (dates with available slots)
                        const events = [];
                        for (const [dateStr, slots] of Object.entries(availableSlotsData)) {
                            if (slots &amp;&amp; slots.length > 0) {
                                events.push({
                                    start: dateStr,
                                    display: 'background',
                                    backgroundColor: '#fff5f8',
                                    classNames: ['available-date']
                                });
                            }
                        }
                        
                        calendar = new FullCalendar.Calendar(calendarEl, {
                            initialView: 'dayGridMonth',
                            headerToolbar: {
                                left: 'prev,next today',
                                center: 'title',
                                right: ''
                            },
                            height: 'auto',
                            events: events,
                            dateClick: function(info) {
                                const dateStr = info.dateStr;
                                
                                // Remove previous date selection
                                document.querySelectorAll('.fc-day').forEach(day => {
                                    day.classList.remove('selected-date');
                                });
                                
                                // Highlight selected date
                                info.dayEl.classList.add('selected-date');
                                
                                // Load time slots for this date
                                loadTimeSlotsForDate(dateStr);
                            },
                            dayCellClassNames: function(arg) {
                                const dateStr = getLocalDateString(arg.date);
                                if (availableSlotsData[dateStr] &amp;&amp; availableSlotsData[dateStr].length > 0) {
                                    return ['has-slots'];
                                }
                                return [];
                            },
                            validRange: {
                                start: new Date().toISOString().split('T')[0]
                            }
                        });
                        
                        calendar.render();
                    });

                    // Promo code validation
                    let appliedPromoCode = null;
                    let promoDiscount = 0;
                    
                    function validatePromoCode() {
                        const promoInput = document.getElementById('promo_code');
                        const promoCode = promoInput.value.trim();
                        const feedback = document.getElementById('promo-feedback');
                        const serviceId = <t t-raw="service.id"/>;
                        const branchId = <t t-raw="staff.branch_id.id if staff.branch_id else 'null'"/>;
                        const servicePrice = <t t-raw="service.price"/>;
                        const bookingFee = <t t-raw="service.booking_fee if service.fee_type == 'partial' else 0"/>;
                        
                        if (!promoCode) {
                            feedback.style.display = 'none';
                            appliedPromoCode = null;
                            promoDiscount = 0;
                            updatePriceSummary();
                            return;
                        }
                        
                        // Call server to validate promo code
                        fetch('/appointments/validate-promo', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                promo_code: promoCode,
                                service_id: serviceId,
                                branch_id: branchId,
                                amount: servicePrice,
                                booking_fee: bookingFee
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            // Unwrap JSON-RPC response if present (Odoo type='json' routes return {jsonrpc, result})
                            const res = data.result || data;
                            feedback.style.display = 'block';
                            if (res.valid) {
                                appliedPromoCode = promoCode;
                                promoDiscount = res.discount_amount || 0;
                                feedback.innerHTML = '<div class="alert alert-success py-2 mb-0" style="border-radius: 10px;">' +
                                    '<i class="fa fa-check-circle mr-2"></i>' +
                                    '<strong>' + (res.promo_name || 'Promo') + '</strong> applied! ' +
                                    'You save <strong>' + (res.currency_symbol || '') + promoDiscount.toFixed(2) + '</strong>' +
                                    '</div>';
                                updatePriceSummary();
                            } else {
                                appliedPromoCode = null;
                                promoDiscount = 0;
                                feedback.innerHTML = '<div class="alert alert-danger py-2 mb-0" style="border-radius: 10px;">' +
                                    '<i class="fa fa-times-circle mr-2"></i>' + (res.message || 'Invalid promo code') +
                                    '</div>';
                                updatePriceSummary();
                            }
                        })
                        .catch(error => {
                            feedback.style.display = 'block';
                            feedback.innerHTML = '<div class="alert alert-warning py-2 mb-0" style="border-radius: 10px;">' +
                                '<i class="fa fa-exclamation-triangle mr-2"></i>Could not validate promo code. Please try again.' +
                                '</div>';
                        });
                    }
                    
                    function updatePriceSummary() {
                        const summaryTotal = document.querySelector('.summary-total');
                        if (!summaryTotal) return;
                        
                        const servicePrice = <t t-raw="service.price"/>;
                        const bookingFee = <t t-raw="service.booking_fee if service.fee_type == 'partial' else 0"/>;
                        const currencySymbol = '<t t-esc="service.currency_id.symbol"/>';
                        const feeType = '<t t-esc="service.fee_type"/>';
                        
                        const finalPrice = Math.max(0, servicePrice - promoDiscount);
                        const finalBookingFee = feeType === 'partial' ? Math.max(0, bookingFee - promoDiscount) : 0;
                        
                        let html = '';
                        if (feeType === 'partial' &amp;&amp; bookingFee > 0) {
                            html = '<div class="d-flex justify-content-between align-items-center mb-2">' +
                                '<span class="font-weight-bold" style="color: #333; font-size: 14px;">Booking Fee (Pay Now)</span>' +
                                '<span class="price font-weight-bold" style="color: #ff69b4; font-size: 18px;">' +
                                currencySymbol + finalBookingFee.toFixed(2) + '</span></div>';
                            if (promoDiscount > 0) {
                                html += '<div class="d-flex justify-content-between align-items-center mb-2">' +
                                    '<span class="text-success" style="font-size: 14px;"><i class="fa fa-tag mr-1"></i>Promo Discount</span>' +
                                    '<span class="text-success" style="font-size: 14px;">-' + currencySymbol + promoDiscount.toFixed(2) + '</span></div>';
                            }
                            html += '<div class="d-flex justify-content-between align-items-center mb-2">' +
                                '<span class="text-muted" style="font-size: 14px;">Balance Due at Appointment</span>' +
                                '<span class="text-muted" style="font-size: 14px;">' + currencySymbol + (finalPrice - finalBookingFee).toFixed(2) + '</span></div>' +
                                '<hr class="my-2"/>' +
                                '<div class="d-flex justify-content-between align-items-center">' +
                                '<span class="font-weight-bold" style="color: #333; font-size: 16px;">Total Price</span>' +
                                '<span class="font-weight-bold" style="color: #333; font-size: 18px;">' + currencySymbol + finalPrice.toFixed(2) + '</span></div>';
                        } else {
                            if (promoDiscount > 0) {
                                html = '<div class="d-flex justify-content-between align-items-center mb-2">' +
                                    '<span class="text-muted" style="font-size: 14px;">Original Price</span>' +
                                    '<span class="text-muted text-decoration-line-through" style="font-size: 14px;">' + currencySymbol + servicePrice.toFixed(2) + '</span></div>' +
                                    '<div class="d-flex justify-content-between align-items-center mb-2">' +
                                    '<span class="text-success" style="font-size: 14px;"><i class="fa fa-tag mr-1"></i>Promo Discount</span>' +
                                    '<span class="text-success" style="font-size: 14px;">-' + currencySymbol + promoDiscount.toFixed(2) + '</span></div>' +
                                    '<hr class="my-2"/>';
                            }
                            html += '<div class="d-flex justify-content-between align-items-center">' +
                                '<span class="font-weight-bold" style="color: #333; font-size: 16px;">Total</span>' +
                                '<span class="price font-weight-bold" style="color: #ff69b4; font-size: 20px;">' + currencySymbol + finalPrice.toFixed(2) + '</span></div>';
                        }
                        
                        summaryTotal.innerHTML = html;
                    }
                    
                    // Auto-apply promo code from URL parameter
                    document.addEventListener('DOMContentLoaded', function() {
                        const urlParams = new URLSearchParams(window.location.search);
                        const promoFromUrl = urlParams.get('promo');
                        if (promoFromUrl) {
                            document.getElementById('promo_code').value = promoFromUrl;
                            validatePromoCode();
                        }
                    });
                </script>
                
                <!-- Custom Calendar Styles -->
                <style>
                    /* FullCalendar customization */
                    #calendar {
                        font-family: inherit;
                    }
                    
                    .fc .fc-button-primary {
                        background-color: #ff69b4;
                        border-color: #ff69b4;
                    }
                    
                    .fc .fc-button-primary:hover {
                        background-color: #ff8da1;
                        border-color: #ff8da1;
                    }
                    
                    .fc .fc-button-primary:not(:disabled):active,
                    .fc .fc-button-primary:not(:disabled).fc-button-active {
                        background-color: #ff69b4;
                        border-color: #ff69b4;
                    }
                    
                    .fc-day.has-slots {
                        cursor: pointer;
                        position: relative;
                    }
                    
                    .fc-day.has-slots:hover {
                        background-color: #fff5f8 !important;
                    }
                    
                    .fc-day.has-slots .fc-daygrid-day-number {
                        color: #ff69b4;
                        font-weight: 600;
                    }
                    
                    .fc-day.has-slots::after {
                        content: '';
                        position: absolute;
                        bottom: 5px;
                        left: 50%;
                        transform: translateX(-50%);
                        width: 6px;
                        height: 6px;
                        background-color: #ff69b4;
                        border-radius: 50%;
                    }
                    
                    .fc-day.selected-date {
                        background-color: #fff5f8 !important;
                        border: 2px solid #ff69b4 !important;
                    }
                    
                    .fc .fc-daygrid-day.fc-day-today {
                        background-color: #f0f8ff !important;
                    }
                    
                    .fc .fc-toolbar-title {
                        font-size: 1.5rem;
                        font-weight: 600;
                        color: #333;
                    }
                    
                    .time-slot-btn:hover {
                        background-color: #ff69b4 !important;
                        color: white !important;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
                    }
                    
                    .time-slot-btn.btn-primary {
                        background-color: #ff69b4 !important;
                        border-color: #ff69b4 !important;
                        color: white !important;
                    }
                </style>
            </div>
        </t>
    </template>

    <!-- Booking Success Page -->
    <template id="booking_success_page" name="Booking Confirmation">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8 text-center">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <i class="fa fa-check-circle fa-5x text-success mb-4"></i>
                                    <h2 class="font-weight-bold mb-3">Booking Confirmed!</h2>
                                    <p class="text-muted mb-4">Your appointment has been successfully booked.</p>
                                    
                                    <div class="booking-details p-4" style="background: #f8f9fa; border-radius: 10px;">
                                        <h5 class="font-weight-bold mb-3">Appointment Details</h5>
                                        <p><strong>Service:</strong> <t t-esc="service.name"/></p>
                                        <p><strong>Staff:</strong> <t t-esc="staff.name"/></p>
                                        <p><strong>Date &amp; Time:</strong> <t t-esc="appointment._get_local_datetime(appointment.start).strftime('%A, %B %d, %Y - %I:%M %p')"/></p>
                                        <p><strong>Duration:</strong> <t t-esc="service.duration"/> hours</p>
                                        <p><strong>Total:</strong> <t t-esc="service.currency_id.symbol"/><t t-esc="service.price"/></p>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <a href="/appointments" class="btn btn-primary mr-3">Book Another</a>
                                        <a href="/" class="btn btn-outline-secondary">Back to Home</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Booking Error Page -->
    <template id="booking_error_page" name="Booking Error">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8 text-center">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <i class="fa fa-exclamation-triangle fa-5x text-warning mb-4"></i>
                                    <h2 class="font-weight-bold mb-3">Booking Error</h2>
                                    <p class="text-muted mb-4">There was an issue processing your booking.</p>
                                    
                                    <div class="error-details p-4" style="background: #fff3cd; border-radius: 10px;">
                                        <p class="mb-0"><t t-esc="error"/></p>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <a href="/appointments" class="btn btn-primary mr-3">Try Again</a>
                                        <a href="/" class="btn btn-outline-secondary">Back to Home</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Payment Page -->
    <template id="payment_page" name="Payment for Appointment">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <h2 class="font-weight-bold mb-4 text-center">Complete Your Payment</h2>
                                    
                                    <!-- Appointment Summary -->
                                    <div class="appointment-summary mb-4 p-4" style="background: #f8f9fa; border-radius: 10px;">
                                        <h5 class="font-weight-bold mb-3">Appointment Summary</h5>
                                        <p><strong>Service:</strong> <t t-esc="appointment.service_id.name"/></p>
                                        <p><strong>Staff:</strong> <t t-esc="appointment.staff_member_id.name"/></p>
                                        <p><strong>Date &amp; Time:</strong> <t t-esc="appointment._get_local_datetime(appointment.start).strftime('%A, %B %d, %Y - %I:%M %p')"/></p>
                                        <p><strong>Duration:</strong> <t t-esc="appointment.service_id.duration"/> hours</p>
                                        
                                        <!-- Promo Code Applied -->
                                        <t t-if="appointment.promo_id and appointment.discount_amount > 0">
                                            <div class="promo-applied mb-3 p-2" style="background: #d4edda; border-radius: 8px; border-left: 4px solid #28a745;">
                                                <div class="d-flex align-items-center">
                                                    <i class="fa fa-tag mr-2 text-success"></i>
                                                    <span class="text-success font-weight-bold">
                                                        Promo Code Applied: <t t-esc="appointment.promo_id.code"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </t>
                                        
                                        <t t-if="appointment.service_id.fee_type == 'partial' and appointment.service_id.booking_fee > 0">
                                            <hr class="my-3"/>
                                            <div class="price-breakdown">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span><strong>Booking Fee (Pay Now):</strong></span>
                                                    <span class="h5 text-primary mb-0">
                                                        <t t-esc="currency.symbol"/><t t-esc="amount"/>
                                                    </span>
                                                </div>
                                                <t t-if="appointment.discount_amount > 0">
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span class="text-success"><i class="fa fa-tag mr-1"></i>Promo Discount:</span>
                                                        <span class="text-success">
                                                            -<t t-esc="currency.symbol"/><t t-esc="appointment.discount_amount"/>
                                                        </span>
                                                    </div>
                                                </t>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span class="text-muted">Balance Due at Appointment:</span>
                                                    <span class="text-muted">
                                                        <t t-esc="currency.symbol"/><t t-esc="appointment.service_id.price - amount - appointment.discount_amount"/>
                                                    </span>
                                                </div>
                                                <hr class="my-2"/>
                                                <div class="d-flex justify-content-between">
                                                    <span><strong>Total Service Price:</strong></span>
                                                    <span class="font-weight-bold">
                                                        <t t-esc="currency.symbol"/><t t-esc="appointment.final_price"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </t>
                                        <t t-else="">
                                            <hr class="my-3"/>
                                            <div class="price-breakdown">
                                                <t t-if="appointment.discount_amount > 0">
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span class="text-muted">Original Price:</span>
                                                        <span class="text-muted text-decoration-line-through">
                                                            <t t-esc="currency.symbol"/><t t-esc="appointment.price"/>
                                                        </span>
                                                    </div>
                                                    <div class="d-flex justify-content-between mb-2">
                                                        <span class="text-success"><i class="fa fa-tag mr-1"></i>Promo Discount:</span>
                                                        <span class="text-success">
                                                            -<t t-esc="currency.symbol"/><t t-esc="appointment.discount_amount"/>
                                                        </span>
                                                    </div>
                                                    <hr class="my-2"/>
                                                </t>
                                                <div class="d-flex justify-content-between">
                                                    <span><strong>Total Amount:</strong></span>
                                                    <span class="h4 text-primary mb-0">
                                                        <t t-esc="currency.symbol"/><t t-esc="appointment.final_price"/>
                                                    </span>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                    
                                    <!-- Payment Methods -->
                                    <form method="post" t-attf-action="/appointments/payment">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <input type="hidden" name="appointment_id" t-att-value="appointment.id"/>
                                        
                                        <h5 class="font-weight-bold mb-3">Select Payment Method</h5>
                                        
                                        <div class="payment-methods mb-4">
                                            <t t-foreach="acquirers" t-as="acquirer">
                                                <div class="payment-option mb-3" t-att-data-code="acquirer.code">
                                                    <div class="card border" style="cursor: pointer;" t-attf-onclick="selectPaymentMethod(this, '#{acquirer.id}', '#{acquirer.code}')">
                                                        <div class="card-body p-3">
                                                            <div class="d-flex align-items-center">
                                                                <input type="radio" name="acquirer_id" t-att-value="acquirer.id" class="mr-3"/>
                                                                <div class="flex-grow-1">
                                                                    <h6 class="mb-1"><t t-esc="acquirer.name"/></h6>
                                                                    <small class="text-muted">Secure payment processing</small>
                                                                </div>
                                                                <div class="ml-3">
                                                                    <i class="fa fa-credit-card fa-2x text-primary"></i>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- M-Pesa Phone Number Field -->
                                                            <t t-if="acquirer.code == 'mpesa'">
                                                                <div class="mt-3 mpesa-phone-field" style="display: none;">
                                                                    <label for="mpesa_phone" class="font-weight-bold">M-Pesa Phone Number *</label>
                                                                    <input type="tel" 
                                                                           id="mpesa_phone" 
                                                                           name="mpesa_phone"
                                                                           class="form-control" 
                                                                           placeholder="254724512285 or 0724512285"
                                                                           pattern="(254|0)[17]\d{8}"/>
                                                                    <small class="form-text text-muted">
                                                                        Enter your M-Pesa registered phone number
                                                                    </small>
                                                                </div>
                                                            </t>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-lg w-100" 
                                                style="background: #ff69b4; color: white; border: none; padding: 15px; border-radius: 25px; font-weight: 600;"
                                                disabled="" id="pay-btn">
                                            Pay <t t-esc="currency.symbol"/><t t-esc="amount"/>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <script>
                    function selectPaymentMethod(element, acquirerId, acquirerCode) {
                        // Remove border from all cards
                        document.querySelectorAll('.payment-option .card').forEach(card => {
                            card.classList.remove('border-primary');
                        });
                        
                        // Hide all M-Pesa phone fields
                        document.querySelectorAll('.mpesa-phone-field').forEach(field => {
                            field.style.display = 'none';
                        });
                        
                        // Select this payment method
                        element.classList.add('border-primary');
                        element.querySelector('input[type="radio"]').checked = true;
                        
                        // Show M-Pesa phone field if this is M-Pesa
                        if (acquirerCode === 'mpesa') {
                            const phoneField = element.querySelector('.mpesa-phone-field');
                            if (phoneField) {
                                phoneField.style.display = 'block';
                            }
                        }
                        
                        document.getElementById('pay-btn').disabled = false;
                    }
                </script>
            </div>
        </t>
    </template>

    <!-- Payment Error Page -->
    <template id="payment_error_page" name="Payment Error">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8 text-center">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <i class="fa fa-exclamation-triangle fa-5x text-warning mb-4"></i>
                                    <h2 class="font-weight-bold mb-3">Payment Error</h2>
                                    <p class="text-muted mb-4">There was an issue processing your payment.</p>
                                    
                                    <div class="error-details p-4" style="background: #fff3cd; border-radius: 10px;">
                                        <p class="mb-0"><t t-esc="error"/></p>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <a href="/appointments" class="btn btn-primary mr-3">Try Again</a>
                                        <a href="/" class="btn btn-outline-secondary">Back to Home</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Payment Success Page -->
    <template id="payment_pending_page" name="Payment Pending">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8 text-center">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <div class="spinner-border text-primary mb-4" role="status" style="width: 4rem; height: 4rem;">
                                        <span class="sr-only">Processing...</span>
                                    </div>
                                    <h2 class="font-weight-bold mb-3">Payment Processing</h2>
                                    <p class="text-muted mb-4">Please check your phone and enter your M-Pesa PIN to complete the payment.</p>
                                    
                                    <div class="alert alert-info" role="alert">
                                        <i class="fa fa-info-circle mr-2"></i>
                                        You should receive an M-Pesa prompt on your phone. Once you complete the payment, this page will automatically update.
                                    </div>
                                    
                                    <div class="appointment-details p-4 mt-4" style="background: #f8f9fa; border-radius: 10px;">
                                        <h5 class="font-weight-bold mb-3">Appointment Details</h5>
                                        <p><strong>Service:</strong> <t t-esc="appointment.service_id.name"/></p>
                                        <p><strong>Staff:</strong> <t t-esc="appointment.staff_member_id.name"/></p>
                                        <p><strong>Date &amp; Time:</strong> <t t-esc="appointment._get_local_datetime(appointment.start).strftime('%A, %B %d, %Y - %I:%M %p')"/></p>
                                        <p class="mb-0"><strong>Amount:</strong> <t t-esc="appointment.currency_id.symbol"/><t t-esc="appointment.price"/></p>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <button id="checkStatusBtn" class="btn btn-primary" onclick="checkPaymentStatus()">Check Payment Status</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <script type="text/javascript">
                    let checkInterval;
                    let appointmentId = <t t-esc="appointment.id"/>;
                    
                    function checkPaymentStatus() {
                        console.log('Checking payment status for appointment:', appointmentId);
                        
                        fetch('/appointment/payment/status', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                jsonrpc: '2.0',
                                method: 'call',
                                params: {
                                    appointment_id: appointmentId
                                },
                                id: new Date().getTime()
                            })
                        })
                        .then(response => response.json())
                        .then(result => {
                            console.log('Payment status response:', result);
                            const data = result.result || {};
                            
                            if (data.error) {
                                console.error('Error:', data.error);
                                return;
                            }
                            
                            if (data.payment_status === 'paid') {
                                clearInterval(checkInterval);
                                alert('Payment successful! Redirecting...');
                                window.location.href = '/appointments/payment/success?appointment_id=' + appointmentId;
                            } else if (data.payment_status === 'failed') {
                                clearInterval(checkInterval);
                                alert('Payment failed. Please try again.');
                                window.location.href = '/appointments/payment?appointment_id=' + appointmentId;
                            } else {
                                console.log('Payment still pending. Status:', data.payment_status);
                            }
                        })
                        .catch(error => {
                            console.error('Error checking payment status:', error);
                        });
                    }
                    
                    // Start auto-checking every 5 seconds
                    checkInterval = setInterval(checkPaymentStatus, 5000);
                    
                    // Stop checking after 2 minutes
                    setTimeout(function() {
                        clearInterval(checkInterval);
                        alert('Payment check timeout. Please refresh the page to check status.');
                    }, 120000);
                </script>
            </div>
        </t>
    </template>
    
    <template id="payment_success_page" name="Payment Success">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure oe_empty">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-md-8 text-center">
                            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                                <div class="card-body p-5">
                                    <i class="fa fa-check-circle fa-5x text-success mb-4"></i>
                                    <h2 class="font-weight-bold mb-3">Payment Successful!</h2>
                                    <p class="text-muted mb-4">Your appointment has been confirmed and payment processed.</p>
                                    
                                    <div class="appointment-details p-4" style="background: #d4edda; border-radius: 10px;">
                                        <h5 class="font-weight-bold mb-3">Appointment Details</h5>
                                        <p><strong>Service:</strong> <t t-esc="appointment.service_id.name"/></p>
                                        <p><strong>Staff:</strong> <t t-esc="appointment.staff_member_id.name"/></p>
                                        <p><strong>Date &amp; Time:</strong> <t t-esc="appointment._get_local_datetime(appointment.start).strftime('%A, %B %d, %Y - %I:%M %p')"/></p>
                                        <p><strong>Amount Paid:</strong> <t t-esc="appointment.currency_id.symbol"/><t t-esc="appointment.paid_amount"/></p>
                                        <p class="mb-0"><strong>Reference:</strong> <t t-esc="appointment.payment_reference"/></p>
                                    </div>
                                    
                                    <div class="mt-4">
                                        <a href="/appointments" class="btn btn-primary mr-3">Book Another</a>
                                        <a href="/" class="btn btn-outline-secondary">Back to Home</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
